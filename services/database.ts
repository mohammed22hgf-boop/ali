
import { AppState, Subject, User, Question, UserRole, QuestionType, ExamAttempt, EnrollmentType } from '../types';

const DB_KEY = 'examSystemDB';
const DB_VERSION = 15; // Incremented to load new questions

const INITIAL_SUBJECTS: Subject[] = [
  { id: 'subj1', name: 'المدخل لدراسة الفقه الإسلامي' },
  { id: 'subj2', name: 'علم الإجرام والعقاب' },
  { id: 'subj3', name: 'اللغة الإنجليزية' },
  { id: 'subj4', name: 'حقوق الإنسان' },
  { id: 'subj5', name: 'العلوم السياسية' },
  { id: 'subj6', name: 'تاريخ النظم الاجتماعية' },
  { id: 'subj7', name: 'مدخل العلوم القانونية' },
];

const INITIAL_USERS: User[] = [
  { 
    id: 'admin01', 
    username: 'admin', 
    email: 'admin@law.edu',
    passwordHash: 'zizo2070', 
    role: UserRole.ADMIN, 
    fullName: 'مدير النظام',
    enrollmentType: EnrollmentType.INTIZAM
  },
];

// Helper to create questions easily
const createQ = (id: string, subjectId: string, type: QuestionType, text: string, correctAnswer: string, options: string[] = [], explanation: string = ''): Question => ({
    id, subjectId, type, text, correctAnswer, options: type === QuestionType.MCQ ? options : undefined, explanation
});

const INITIAL_QUESTIONS: Question[] = [
    // --- علم الإجرام والعقاب (MCQ) ---
    createQ('q_crm_1', 'subj2', QuestionType.MCQ, 'في رأي فرويد تسمى حالة التعلق اللاشعوري للبنت بأبيها...', '0', ['عقدة الكترا', 'عقدة أوديب', 'عقدة الذنب', 'عقدة النقص'], 'ورد في الكتاب (ص 24) أن "عقدة الكترا" تنجم عن التعلق اللاشعوري للبنت بأبيها.'),
    createQ('q_crm_2', 'subj2', QuestionType.MCQ, 'وفقاً لنظرية لومبروزو من يعاني من ضمور في العضلات يحد من الوظائف النفسية هو...', '0', ['المجرم الصرعي', 'المجرم العاطفي', 'المجرم بالصدفة', 'المجرم ذو التقويم الناقص'], 'ورد في الكتاب (ص 10) أن المجرم الصرعي هو المصاب بصرع وراثي يؤدي إلى ضمور في بعض العضلات.'),
    createQ('q_crm_3', 'subj2', QuestionType.MCQ, 'في رأي فرويد يسمى الشق الشهواني من النفس البشرية...', '0', ['الأنا الدنيا (الذات)', 'الأنا العليا', 'الأنا', 'الواقعية'], 'ورد في الكتاب (ص 19) أن "الذات" أو "الأنا الدنيا" هي الشق الشهواني ومستودع الشهوات.'),
    createQ('q_crm_4', 'subj2', QuestionType.MCQ, 'وفقاً لنظرية لومبروزو يعد المجرم المدمن من طائفة...', '3', ['معتادي الإجرام', 'الهستيريين', 'العاطفيين', 'المجرمين بالصدفة'], 'ورد في الكتاب (ص 12) تصنيف "المجرم المدمن" كنوع يندرج تحت المجرمين بالصدفة.'),
    createQ('q_crm_5', 'subj2', QuestionType.MCQ, 'تقوم نظرية لومبروزو على أن...', '3', ['الجريمة تنتقل بالوراثة', 'المجرم مسير في ارتكاب الجريمة', 'المجرم لديه خلل في التكوين العضوي', 'كل ما سبق'], 'ورد في الكتاب (ص 7-8) أن نظرية لومبروزو تقوم على الارتداد الوراثي وحتمية الجريمة والخلل العضوي.'),
    createQ('q_crm_6', 'subj2', QuestionType.MCQ, 'من تنعدم لديه القدرة على التكيف مع المجتمع ويخالف قوانينه يسمى...', '0', ['المجرم السيكوباتي', 'المجرم العاطفي', 'المجرم بالصدفة', 'المجرم المعتاد'], 'ورد في الكتاب (ص 10) أن المجرم السيكوباتي هو الذي تنعدم لديه القدرة على التكيف.'),
    createQ('q_crm_7', 'subj2', QuestionType.MCQ, 'الطائفة التي لا تتبع تقسيم انريكو فيري للمجرمين هي...', '3', ['المجرمين بالميلاد', 'المجرمين بالاعتياد', 'المجرمين بالصدفة', 'المجرمين المدمنين'], 'المدمن تصنيف مستقل ذكره لومبروزو وليس فيري.'),
    createQ('q_crm_8', 'subj2', QuestionType.MCQ, 'النفس العاقلة في رأي فرويد تسمى...', '2', ['الذات', 'الضمير', 'الأنا', 'النفس اللوامة'], 'ورد في الكتاب (ص 20) أن "الأنا" (Ego) تمثل الجانب الواعي والعاقل.'),
    createQ('q_crm_9', 'subj2', QuestionType.MCQ, 'من يرتكب جريمة شكلية يعد في رأي لومبروزو...', '2', ['مجرم بالصدفة', 'مجرم عاطفي', 'مجرم حكماً', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 11) أن "المجرم حكماً" هو من يرتكب جريمة شكلية.'),
    createQ('q_crm_10', 'subj2', QuestionType.MCQ, 'في رأي لومبروزو المجرم المجنون خلقياً هو...', '2', ['العاطفي', 'المدمن', 'السيكوباتي', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 10): المجرم السيكوباتي أو ما يطلق عليه المجنون خلقياً.'),
    createQ('q_crm_11', 'subj2', QuestionType.MCQ, 'يعاب على نظريته الإسراف في الاعتماد على العامل الجنسي لتفسير السلوك الإنساني...', '0', ['فرويد', 'سذرلاند', 'تارد', 'لا شيء مما سبق'], 'ورد في نقد نظرية فرويد (ص 25).'),
    createQ('q_crm_12', 'subj2', QuestionType.MCQ, 'يتمثل الاختلاف بين لومبروزو وانريكو فيري حول المجرم بالميلاد في...', '0', ['حتمية الجريمة', 'الخلل العضوي', 'أثر الوراثة', 'لا شيء مما سبق'], 'فيري لا يرى أن المجرم بالميلاد سيقع حتماً في الجريمة.'),
    createQ('q_crm_13', 'subj2', QuestionType.MCQ, 'الذي يرتكب الجريمة تحت ضغط المؤثرات الخارجية الطارئة دون امتداد إجرامي هو...', '1', ['المجرم العاطفي', 'المجرم بالصدفة', 'المجرم حكماً', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 11) تعريف المجرم بالصدفة.'),
    createQ('q_crm_14', 'subj2', QuestionType.MCQ, 'تمثل فكرة الارتداد جوهر نظريته في تفسير السلوك الإجرامي...', '1', ['دي توليو', 'لومبروزو', 'فرويد', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 7).'),
    createQ('q_crm_15', 'subj2', QuestionType.MCQ, 'يتميز المجرم في رأي لومبروزو بصفات نفسية أهمها...', '0', ['انعدام الحس الأخلاقي', 'الشعور بالخجل', 'المبالاة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 9) انعدام الحس الأخلاقي وقلة الشعور بالألم.'),
    createQ('q_crm_16', 'subj2', QuestionType.MCQ, 'عندما يكون عدم التكيف هو المحرك نحو ارتكاب الجريمة فإن من يرتكبها هو...', '1', ['المجرم المدمن', 'المجرم السيكوباتي', 'المجرم المعتاد', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 10).'),
    createQ('q_crm_17', 'subj2', QuestionType.MCQ, 'تعتمد نظرية ......... على اللاشعور في تفسير سلوك الفرد.', '2', ['ميرتون', 'تارد', 'فرويد', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 21).'),
    createQ('q_crm_18', 'subj2', QuestionType.MCQ, 'وفقاً لنظرية فرويد فإن تأنيب الضمير يمكن أن تنشأ عنه عقدة...', '1', ['النقص', 'الذنب', 'أوديب', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 23) أن عقدة الذنب تنجم عن تأنيب الضمير.'),
    createQ('q_crm_19', 'subj2', QuestionType.MCQ, 'وفقاً لتصنيف لومبروزو للمجرمين فإن المجرم الهستيري يتبع طائفة المجرم...', '0', ['المجنون', 'السيكوباتي', 'الصرعي', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 10) ضمن طائفة المجرم المجنون.'),
    createQ('q_crm_20', 'subj2', QuestionType.MCQ, 'في رأي ميرتون النمط الذي يتسم بالاستسلام ورفض قيم المجتمع وعدم طرح قيم بديلة يسمى...', '0', ['الشعائرية', 'الابتكارية', 'التوافقية', 'التمردية'], 'ورد في الكتاب (ص 38).'),
    createQ('q_crm_21', 'subj2', QuestionType.MCQ, 'من النظريات التي تصلح لتفسير سلوك العصابات وجرائمها...', '0', ['المخالطة الفارقة', 'التقليد', 'دوركايم', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 53) نظرية سذرلاند.'),
    createQ('q_crm_22', 'subj2', QuestionType.MCQ, 'رفض قيم المجتمع ومعاييره، مع إيجاد قيم بديلة يسمى نمط الاستجابة...', '0', ['التمردية', 'التوافقية', 'الابتكارية', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 39-40).'),
    createQ('q_crm_23', 'subj2', QuestionType.MCQ, 'ترتكب الجريمة عن طريق التعلم في رأي...', '0', ['سذرلاند', 'فرويد', 'دوركايم', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 48).'),
    createQ('q_crm_24', 'subj2', QuestionType.MCQ, 'ترتكب الجريمة عن طريق التقليد في رأي...', '1', ['ميرتون', 'تارد', 'دي توليو', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 44).'),
    createQ('q_crm_25', 'subj2', QuestionType.MCQ, 'نظرية ميرتون هي إحدى نظريات ......... لتفسير الظاهرة الإجرامية.', '1', ['الكيفية الاجتماعية', 'البناء الاجتماعي', 'التفسير التكاملي', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 34-35).'),
    createQ('q_crm_26', 'subj2', QuestionType.MCQ, 'تشير الإحصاءات إلى ارتفاع جرائم الاعتداء على الأشخاص في...', '3', ['الربيع', 'الشتاء', 'الخريف', 'الصيف'], 'ورد في الكتاب (ص 156) القانون الحراري لكيتليه.'),
    createQ('q_crm_27', 'subj2', QuestionType.MCQ, 'مرحلة النضج المتوسط تتراوح بين...', '1', ['18-25 سنة', '25-35 سنة', '35-45 سنة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 97).'),
    createQ('q_crm_28', 'subj2', QuestionType.MCQ, 'عدد الجرائم عند بداية الحرب...', '2', ['يزيد', 'تزداد جرائم العرض فقط', 'يقل', 'تزيد السرقة فقط'], 'ورد في الكتاب (ص 146) يهبط معدل الجرائم.'),
    createQ('q_crm_29', 'subj2', QuestionType.MCQ, 'عندما ينتقل إلى الفرع شذوذ في التكوين نتيجة إصابة الأصل بمرض معين تسمى...', '3', ['الوراثة التشخيصية', 'الوراثة التشابهية', 'الوراثة المرضية', 'الوراثة التشويهية'], 'ورد في الكتاب (ص 83).'),
    createQ('q_crm_30', 'subj2', QuestionType.MCQ, 'عندما يقع الحمل ويكون أحد الزوجين في حالة سكر فإن التأثير ينتقل إلى الجنين عن طريق...', '1', ['الوراثة الحقيقية', 'الوراثة الاعتبارية', 'الوراثة المباشرة', 'الوراثة غير المباشرة'], 'ورد في الكتاب (ص 83).'),
    createQ('q_crm_31', 'subj2', QuestionType.MCQ, 'إذا صدر قانون يساوي بين الرجل والمرأة في الميراث بالمخالفة للشريعة الإسلامية فإن ذلك يؤدي إلى...', '1', ['عدم تأثر نسبة الجريمة', 'زيادة نسبة الجريمة', 'تقليل نسبة الجريمة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 131).'),
    createQ('q_crm_32', 'subj2', QuestionType.MCQ, 'تأثر الجنين بالسلوكيات الخاطئة للأم في فترات الحمل يسمى...', '1', ['الوراثة التشابهية', 'الوراثة التشويهية', 'الوراثة المرضية', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 83).'),
    createQ('q_crm_33', 'subj2', QuestionType.MCQ, 'الحد الأقصى لعقوبة الحبس هو...', '0', ['3 سنوات', '6 شهور', '3 شهور', 'سنة واحدة'], 'ورد في الكتاب (ص 197).'),
    createQ('q_crm_34', 'subj2', QuestionType.MCQ, 'الحد الأقصى لعقوبة السجن المؤبد...', '3', ['15 سنة', '20 سنة', '25 سنة', 'لا شيء مما سبق (يستغرق الحياة)'], 'ورد في الكتاب (ص 203).'),
    createQ('q_crm_35', 'subj2', QuestionType.MCQ, 'إذا قضت المحكمة بعقوبة سالبة للحرية لمدة 3 سنوات فإن هذه العقوبة قد تكون...', '3', ['الحبس', 'السجن', 'السجن المشدد', 'كل ما سبق'], 'الحبس حده الأقصى 3 سنوات والسجن والمشدد حدهما الأدنى 3 سنوات.'),
    createQ('q_crm_36', 'subj2', QuestionType.MCQ, 'القاعدة العامة أن الحد الأقصى للغرامة في الجنح لا يزيد على...', '3', ['1000 جنيه', '150 جنيه', '300 جنيه', '500 جنيه'], 'ورد في الكتاب (ص 200).'),
    createQ('q_crm_37', 'subj2', QuestionType.MCQ, 'لا يجوز أن يقل الحد الأدنى لعقوبة الغرامة عن...', '0', ['مائة قرش', 'خمسة جنيهات', 'مائة جنيه', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 199).'),
    createQ('q_crm_38', 'subj2', QuestionType.MCQ, 'يصدر الحكم بالتعويض المدني من...', '2', ['المحاكم الجنائية (استثناء المدنية)', 'المحاكم المدنية فقط', 'المحاكم المدنية (استثناء الجنائية)', 'لا شيء مما سبق'], 'الأصل للمحاكم المدنية والاستثناء للجنائية.'),
    createQ('q_crm_39', 'subj2', QuestionType.MCQ, 'الوضع تحت مراقبة الشرطة من العقوبات...', '2', ['السالبة للحقوق', 'السالبة للحرية', 'المقيدة للحرية', 'المقيدة للحقوق'], 'ورد في الكتاب (ص 198).'),
    createQ('q_crm_40', 'subj2', QuestionType.MCQ, 'تشترك عقوبة الحبس مع عقوبة السجن في أن...', '0', ['الحد الأدنى للسجن هو الحد الأقصى للحبس', 'الحد الأقصى للسجن يعادل ضعف الحد الأقصى للحبس', 'الحد الأدنى للحبس نصف الحد الأدنى للسجن', 'لا شيء مما سبق'], 'كلاهما يلتقيان عند 3 سنوات.'),
    createQ('q_crm_41', 'subj2', QuestionType.MCQ, 'تختلف المصادرة عن الغرامة في أن الأولى...', '1', ['عقوبة نقدية', 'لا يحكم بها في المخالفات', 'عقوبة أصلية بحسب الأصل', 'لا شيء مما سبق'], 'المصادرة للجنايات والجنح فقط.'),
    createQ('q_crm_42', 'subj2', QuestionType.MCQ, 'عقوبة السجن لمدة ثلاث سنوات من العقوبات المقررة...', '2', ['للجنايات والجنح', 'للجنح', 'للجنايات', 'لا شيء مما سبق'], 'السجن عقوبة خاصة بالجنايات.'),
    createQ('q_crm_43', 'subj2', QuestionType.MCQ, 'نشر حكم الإدانة في الصحف يعد من العقوبات...', '1', ['الماسة بالحقوق', 'الماسة بالاعتبار', 'الماسة بالحرية', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 199).'),
    createQ('q_crm_44', 'subj2', QuestionType.MCQ, 'قال الله تعالى "ولا تزر وازرة وزر أخرى" وهذه الآية تعبر عن مبدأ...', '0', ['شخصية العقوبة', 'تفريد العقوبة', 'إنسانية العقوبة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 190).'),
    createQ('q_crm_45', 'subj2', QuestionType.MCQ, 'يقصد بالإيلام كعنصر من عناصر العقوبة...', '0', ['المساس بحق من حقوق المحكوم عليه', 'الهوان', 'الإذلال', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 182).'),
    createQ('q_crm_46', 'subj2', QuestionType.MCQ, 'تختلف العقوبة التبعية عن التكميلية في أن الأولى...', '2', ['يجب أن ينص عليها في الحكم', 'تكفي بذاتها كجزاء للجريمة', 'تقع بقوة القانون', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 204).'),
    createQ('q_crm_47', 'subj2', QuestionType.MCQ, 'إيداع الطفل في مؤسسة خاصة بالأحداث يعد من التدابير...', '1', ['المقيدة للحرية', 'السالبة للحرية', 'العينية', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 214).'),
    createQ('q_crm_48', 'subj2', QuestionType.MCQ, 'تنفذ عقوبة السجن المؤبد على الرجال الذين تجاوزوا الستين من العمر في...', '1', ['السجون المركزية', 'السجون العمومية', 'الليمانات', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 196).'),
    createQ('q_crm_49', 'subj2', QuestionType.MCQ, 'ينفذ حكم الإعدام على المرأة الحبلى...', '1', ['فور صدوره', 'بعد الوضع بشهرين', 'بعد الوضع بعامين', 'بعد الوضع بتسعة أشهر'], 'ورد في الكتاب (ص 211).'),
    createQ('q_crm_50', 'subj2', QuestionType.MCQ, 'يجوز الإفراج الشرطي عن المحكوم عليه بالسجن المؤبد...', '0', ['بعد 20 سنة', 'بعد 25 سنة', 'بعد 30 سنة', 'كل ما سبق'], 'ورد في الكتاب (ص 196).'),
    createQ('q_crm_51', 'subj2', QuestionType.MCQ, 'تنفذ عقوبة السجن المشدد على الرجال الذين لم يجاوزوا الستين من العمر في...', '2', ['السجون المركزية', 'السجون العمومية', 'الليمانات', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 196).'),
    createQ('q_crm_52', 'subj2', QuestionType.MCQ, 'يجب لوقف تنفيذ العقوبة أن تكون الجريمة من...', '2', ['الجنح فقط', 'الجنايات فقط', 'الجنايات أو الجنح', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 285).'),
    createQ('q_crm_53', 'subj2', QuestionType.MCQ, 'تنفذ عقوبة السجن المؤبد على النساء في...', '0', ['السجون العمومية', 'السجون المركزية', 'الليمانات', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 196).'),
    createQ('q_crm_54', 'subj2', QuestionType.MCQ, 'تنفذ عقوبة السجن على الرجال الذين لم يجاوزوا الستين من العمر في...', '2', ['السجون المركزية', 'الليمانات', 'السجون العمومية', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 196).'),
    createQ('q_crm_55', 'subj2', QuestionType.MCQ, 'تنفذ عقوبة السجن على الرجال الذين جاوزوا الستين من العمر في...', '2', ['السجون المركزية', 'الليمانات', 'السجون العمومية', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 196).'),
    createQ('q_crm_56', 'subj2', QuestionType.MCQ, 'وقف تنفيذ العقوبة يعد نوعاً من...', '1', ['التفريد التشريعي', 'التفريد القضائي', 'التفريد الإداري', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 192).'),
    createQ('q_crm_57', 'subj2', QuestionType.MCQ, 'حق رئيس الدولة في العفو عن العقوبة...', '1', ['تفريد قضائي', 'تفريد إداري', 'تفريد تشريعي', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 192).'),
    createQ('q_crm_58', 'subj2', QuestionType.MCQ, 'الأصل أن تنفذ عقوبة الحبس في...', '2', ['الليمانات', 'سجون خاصة', 'السجون المركزية', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 197).'),
    createQ('q_crm_59', 'subj2', QuestionType.MCQ, 'يطبق نظام وقف تنفيذ العقوبة في القانون المصري إذا كانت العقوبة...', '2', ['الحبس عموماً', 'الغرامة فقط', 'الحبس الذي لا يزيد عن سنة أو الغرامة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 285).'),
    createQ('q_crm_60', 'subj2', QuestionType.MCQ, 'تنفذ عقوبة السجن المشدد على النساء في...', '2', ['الليمانات', 'السجن المركزي', 'السجن العمومي', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 196).'),
    createQ('q_crm_61', 'subj2', QuestionType.MCQ, 'يشترط في العمل العقابي...', '3', ['أن يكون منتجاً', 'أن يكون متنوعاً', 'أن يكون بمقابل', 'كل ما سبق'], 'ورد في الكتاب (ص 263).'),
    createQ('q_crm_62', 'subj2', QuestionType.MCQ, 'الإفراج الشرطي عن المحكوم عليه...', '0', ['تفريد إداري', 'تفريد قضائي', 'تفريد تشريعي', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 192).'),
    createQ('q_crm_63', 'subj2', QuestionType.MCQ, 'يصدر الحكم بالإعدام...', '1', ['بأغلبية الآراء', 'بإجماع الآراء', 'بإجماع بعد موافقة المفتي', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 210).'),
    createQ('q_crm_64', 'subj2', QuestionType.MCQ, 'أكثر أساليب العمل العقابي تحقيقاً لهدف التأهيل هو...', '0', ['نظام الاستغلال المباشر', 'نظام المقاولة', 'نظام التوريد', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 267).'),
    createQ('q_crm_65', 'subj2', QuestionType.MCQ, 'تستوجب مخالفة أحكام مراقبة الشرطة الحكم على مرتكبها بعقوبة...', '2', ['السجن 5 سنوات كحد أقصى', 'الحبس 6 أشهر كحد أدنى', 'الحبس سنة كحد أقصى', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 198).'),
    createQ('q_crm_66', 'subj2', QuestionType.MCQ, 'يسمى تقسيم المحكوم عليهم بحسب النوع والسن والخطورة والحالة الصحية...', '2', ['التفريد التشريعي', 'التفريد القضائي', 'التصنيف', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 252).'),
    createQ('q_crm_67', 'subj2', QuestionType.MCQ, 'يتولى ........ عرض الحكم النهائي الصادر بالإعدام على رئيس الجمهورية.', '2', ['رئيس الوزراء', 'النائب العام', 'وزير العدل', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 211).'),
    createQ('q_crm_68', 'subj2', QuestionType.MCQ, 'من خصائص التدابير الاحترازية...', '0', ['يطبق بأثر رجعي', 'يجوز إيقاف تنفيذه', 'يجوز العفو عنه بقرار من رئيس الدولة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 218).'),
    createQ('q_crm_69', 'subj2', QuestionType.MCQ, 'ينفذ الإكراه البدني في السجون...', '2', ['الخاصة', 'العمومية', 'المركزية', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 244).'),
    createQ('q_crm_70', 'subj2', QuestionType.MCQ, 'يستثنى من الخضوع لعقوبة مراقبة الشرطة...', '0', ['من لم يبلغ 18 سنة', 'النساء', 'من تجاوز سن الستين من الرجال', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 198).'),
    createQ('q_crm_71', 'subj2', QuestionType.MCQ, 'من أنواع التفريد القضائي...', '2', ['العفو عن العقوبة', 'الإفراج الشرطي', 'وقف تنفيذ العقوبة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 192).'),
    createQ('q_crm_72', 'subj2', QuestionType.MCQ, 'أخذ رأي مفتي الجمهورية عند الحكم بالإعدام...', '1', ['ملزم إذا ورد في المدة المحددة', 'ملزم للمحكمة (كإجراء)', 'غير ملزم للمحكمة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 210).'),
    createQ('q_crm_73', 'subj2', QuestionType.MCQ, 'إذا ألغي الإفراج الشرطي عن المحكوم عليه بالمؤبد فيجوز أن يستفيد مرة أخرى بعد مرور...', '0', ['5 سنوات على الأقل', '20 سنة على الأقل', '25 سنة على الأقل', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 294).'),
    createQ('q_crm_74', 'subj2', QuestionType.MCQ, 'يؤجل تنفيذ عقوبة الإعدام على المرأة الحبلى إلى ما بعد ........ من الوضع.', '2', ['تسعة أشهر', 'عامين', 'شهرين', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 211).'),
    createQ('q_crm_75', 'subj2', QuestionType.MCQ, 'يجوز الإفراج الشرطي عن المحكوم عليه للقانون المصري بعد مرور ........ على الأقل.', '1', ['ثلاثة أرباع المدة', 'نصف المدة', 'ربع المدة', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 289).'),
    createQ('q_crm_76', 'subj2', QuestionType.MCQ, 'وفقا للقانون المصري يطبق نظام إيقاف التنفيذ إذا كانت الجريمة من...', '2', ['الجنايات فقط', 'الجنح فقط', 'الجنايات والجنح', 'لا شيء مما سبق'], 'ورد في الكتاب (ص 285).'),

    // --- علم الإجرام والعقاب (True/False) ---
    createQ('q_crm_tf_1', 'subj2', QuestionType.TRUE_FALSE, 'يتميز المجرم في رأي لومبروزو بصفات نفسية أهمها المبالاة.', 'false', [], 'خطأ، من صفاته "عدم المبالاة" (ص 9).'),
    createQ('q_crm_tf_2', 'subj2', QuestionType.TRUE_FALSE, 'يعاب على نظرية فرويد الإسراف في الاعتماد على العامل الجنسي لتفسير السلوك الإنساني.', 'true', [], 'صح (ص 25).'),
    createQ('q_crm_tf_3', 'subj2', QuestionType.TRUE_FALSE, 'في رأي لومبروزو الذي يرتكب الجريمة تحت ضغط المؤثرات الخارجية الطارئة دون أن يكون لديه استعداد إجرامي هو المجرم بالصدفة.', 'true', [], 'صح (ص 11).'),
    createQ('q_crm_tf_4', 'subj2', QuestionType.TRUE_FALSE, 'الأنا الدنيا في رأي فرويد هي النفس ذات الشهوة.', 'true', [], 'صح (ص 19).'),
    createQ('q_crm_tf_5', 'subj2', QuestionType.TRUE_FALSE, 'النفس العاقلة في رأي فرويد تشير إلى الضمير.', 'false', [], 'خطأ، النفس العاقلة هي الأنا، والضمير هو الأنا العليا (ص 20).'),
    createQ('q_crm_tf_6', 'subj2', QuestionType.TRUE_FALSE, 'وفقا لنظرية فرويد فإن الأنا العليا هي مصدر القوة الرادعة للشهوات الذات.', 'true', [], 'صح (ص 20).'),
    createQ('q_crm_tf_7', 'subj2', QuestionType.TRUE_FALSE, 'تأثر الجنين بالسلوكيات الخاطئة للأم في فترات الحمل يسمى الوراثة التشابهية.', 'false', [], 'خطأ، يسمى الوراثة التشويهية (ص 83).'),
    createQ('q_crm_tf_8', 'subj2', QuestionType.TRUE_FALSE, 'يؤدي انتشار الوسائل التقنية الحديثة إلى زيادة نسبة الجرائم.', 'true', [], 'صح (ص 142).'),
    createQ('q_crm_tf_9', 'subj2', QuestionType.TRUE_FALSE, 'يمكن أن يؤدي التمسك بتعاليم الدين بمفهومه في علم الإجرام إلى ارتكاب بعض الجرائم.', 'true', [], 'صح (ص 130).'),
    createQ('q_crm_tf_10', 'subj2', QuestionType.TRUE_FALSE, 'وفقا للإحصاءات الجنائية فإن نسبة الإجرام تزيد عند بداية الحرب.', 'false', [], 'خطأ، تهبط النسبة (ص 146).'),
    createQ('q_crm_tf_11', 'subj2', QuestionType.TRUE_FALSE, 'تبلغ جرائم الاعتداء على الأشخاص أقصى معدل لها في فصل الصيف.', 'true', [], 'صح (ص 156).'),
    createQ('q_crm_tf_12', 'subj2', QuestionType.TRUE_FALSE, 'تخضع التدابير الاحترازية لنظرية الظروف المخففة.', 'false', [], 'خطأ، لا تخضع لها (ص 218).'),
    createQ('q_crm_tf_13', 'subj2', QuestionType.TRUE_FALSE, 'لا يجوز إلغاء إيقاف التنفيذ إلا من المحكمة التي أمرت به.', 'false', [], 'خطأ، يجوز أيضاً من المحكمة التي تصدر العقوبة اللاحقة (ص 287).'),
    createQ('q_crm_tf_14', 'subj2', QuestionType.TRUE_FALSE, 'الحد الأقصى للغرامة النسبية في الجنح لا يزيد عن 500 جنيه كقاعدة عامة.', 'true', [], 'صح (ص 200).'),
    createQ('q_crm_tf_15', 'subj2', QuestionType.TRUE_FALSE, 'يجوز الحكم على المتهم بعقوبة الحبس مع الشغل ولو لمدة أقل من سنة.', 'true', [], 'صح (ص 197).'),
    createQ('q_crm_tf_16', 'subj2', QuestionType.TRUE_FALSE, 'يجوز تشغيل المحكوم عليه بالحبس البسيط لمدة لا تجاوز ثلاثة شهور خارج السجن بدلاً من تنفيذ عقوبة الحبس.', 'true', [], 'صح (ص 197).'),
    createQ('q_crm_tf_17', 'subj2', QuestionType.TRUE_FALSE, 'تسمع شهادة المحكوم عليه بعقوبة جناية بعد تحليفه اليمين على سبيل الاستدلال فقط.', 'false', [], 'خطأ، تسمع على سبيل الاستدلال أي بدون حلف يمين (ص 199).'),
    createQ('q_crm_tf_18', 'subj2', QuestionType.TRUE_FALSE, 'يجب ألا يقل الحد الأدنى العام لعقوبة الحبس عن 24 ساعة.', 'true', [], 'صح (ص 197).'),
    createQ('q_crm_tf_19', 'subj2', QuestionType.TRUE_FALSE, 'الحد الأقصى للسجن المؤبد 25 سنة.', 'false', [], 'خطأ، يستغرق الحياة (ص 203).'),
    createQ('q_crm_tf_20', 'subj2', QuestionType.TRUE_FALSE, 'يقصد بالإيلام كعنصر من عناصر العقوبة إذلال المحكوم عليه.', 'false', [], 'خطأ، ليس المقصود الإذلال (ص 182).'),
    createQ('q_crm_tf_21', 'subj2', QuestionType.TRUE_FALSE, 'الأخذ برأي مفتي الجمهورية عند الحكم بالإعدام ملزم للمحكمة.', 'false', [], 'خطأ، الإجراء ملزم لكن الرأي استشاري (ص 210).'),
    createQ('q_crm_tf_22', 'subj2', QuestionType.TRUE_FALSE, 'لا يجوز بأي حال من الأحوال أن تزيد مدة السجن المشدد عن 15 سنة.', 'false', [], 'خطأ، يجوز في أحوال خاصة (ص 196).'),
    createQ('q_crm_tf_23', 'subj2', QuestionType.TRUE_FALSE, 'إذا كان مرتكب جريمة إسقاط الحوامل صيدلانياً فإن ذلك يعد ظرفاً مشدداً للعقاب.', 'true', [], 'صح (ص 113).'),
    createQ('q_crm_tf_24', 'subj2', QuestionType.TRUE_FALSE, 'قتل الزوج زوجته ومن يزني بها حال مفاجأتهما يعد مثالاً للظروف المعفية من العقاب.', 'false', [], 'خطأ، هو عذر مخفف وليس معفي (ص 69).'),
    createQ('q_crm_tf_25', 'subj2', QuestionType.TRUE_FALSE, 'تجاوز حدود حق الدفاع الشرعي بنية سليمة يعد عذراً قانونياً يجب أن يلتزم به القاضي.', 'true', [], 'صح (ص 192).'),
    createQ('q_crm_tf_26', 'subj2', QuestionType.TRUE_FALSE, 'يستثنى من الخضوع لعقوبة مراقبة الشرطة الأطفال المشردين الذين لم يجاوزوا ثماني عشرة سنة.', 'true', [], 'صح (ص 198).'),
    createQ('q_crm_tf_27', 'subj2', QuestionType.TRUE_FALSE, 'إذا كانت النيابة العامة هي من طالبت بإعدام المتهم فلا يجوز لها الطعن بالنقض على الحكم الصادر بالإعدام.', 'false', [], 'خطأ، يجب عرض الحكم على النقض (ص 211).'),
    createQ('q_crm_tf_28', 'subj2', QuestionType.TRUE_FALSE, 'إذا ارتكبت جريمة بين شخصين وطبقت المحكمة عليهما نصاً قانونياً واحداً ولكن بعقوبات مختلفة فهذا يخالف مبدأ الشرعية.', 'false', [], 'خطأ، هذا تفريد للعقوبة (ص 191).'),
    createQ('q_crm_tf_29', 'subj2', QuestionType.TRUE_FALSE, 'يجب تشغيل المدان بالحبس البسيط لمدة لا تجاوز 3 شهور خارج السجن بدلاً من تنفيذ عقوبة الحبس.', 'false', [], 'خطأ، يجوز وليس يجب (ص 197).'),
    createQ('q_crm_tf_30', 'subj2', QuestionType.TRUE_FALSE, 'تخضع التدابير الاحترازية لعدم وقف التنفيذ.', 'true', [], 'صح، لا يجوز وقف تنفيذها (ص 218).'),
    createQ('q_crm_tf_31', 'subj2', QuestionType.TRUE_FALSE, 'وفقا للقانون المصري يكون تنفيذ عقوبة الإعدام في مكان عام بحضور الجمهور.', 'false', [], 'خطأ، داخل السجن (ص 211).'),
    createQ('q_crm_tf_32', 'subj2', QuestionType.TRUE_FALSE, 'تتميز التدابير الاحترازية بأنها قابلة للتعديل أثناء التنفيذ.', 'true', [], 'صح (ص 218).'),
    createQ('q_crm_tf_33', 'subj2', QuestionType.TRUE_FALSE, 'يلغى إيقاف التنفيذ إذا ارتكب المستفيد منه جريمة يعاقب عليها القانون بالحبس لمدة أكثر من شهر أثناء فترة التجربة.', 'true', [], 'صح (ص 287).'),
    createQ('q_crm_tf_34', 'subj2', QuestionType.TRUE_FALSE, 'وفقا للقانون المصري فإن الإفراج الشرطي عن المحكوم عليه بالمؤبد يعتبر نهائياً بعد مرور خمس سنوات من وقت الإفراج.', 'true', [], 'صح (ص 294).'),
    createQ('q_crm_tf_35', 'subj2', QuestionType.TRUE_FALSE, 'يجوز أن يفرج تحت شرط عن المحكوم عليه بالمؤبد بعد قضاء 30 سنة من العقوبة.', 'false', [], 'خطأ، بعد 20 سنة (ص 196).'),
];

const getInitialExamSettings = () => {
    const settings: { [subjectId: string]: { 
        isOpen: boolean; 
        section?: string; 
        questionCount: number; 
        durationMinutes: number; 
        allowRetakes: boolean; 
    } } = {};
    INITIAL_SUBJECTS.forEach(subject => {
        settings[subject.id] = { 
            isOpen: true,
            questionCount: 20, 
            durationMinutes: 30,
            allowRetakes: true, 
        };
    });
    return settings;
};

export const initializeDB = (): AppState => {
  const dbString = localStorage.getItem(DB_KEY);
  
  if (dbString) {
    try {
      const parsedDb = JSON.parse(dbString) as AppState;
      if (!parsedDb.version || parsedDb.version < DB_VERSION) {
        console.log(`Old DB version detected. Resetting database to v${DB_VERSION}.`);
        localStorage.removeItem(DB_KEY);
        return initializeDB(); 
      }
      return parsedDb;
    } catch (e) {
      console.error("Failed to parse DB, resetting.", e);
      localStorage.removeItem(DB_KEY);
      return initializeDB();
    }
  } else {
    const initialState: AppState = {
        version: DB_VERSION,
        users: INITIAL_USERS,
        questions: INITIAL_QUESTIONS,
        subjects: INITIAL_SUBJECTS,
        examAttempts: [],
        examSettings: getInitialExamSettings(),
    };
    localStorage.setItem(DB_KEY, JSON.stringify(initialState));
    return initialState;
  }
};

export const getDB = (): AppState => {
  const db = localStorage.getItem(DB_KEY);
  if (!db) return initializeDB();
  return JSON.parse(db);
};

export const saveDB = (state: AppState) => {
  localStorage.setItem(DB_KEY, JSON.stringify(state));
};
